name: Build iOS18SiriRipple Deb

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Theos environment
        run: |
          export THEOS=/opt/theos
          sudo git clone --depth=1 https://github.com/theos/theos.git $THEOS
          echo "THEOS=$THEOS" >> $GITHUB_ENV
          sudo $THEOS/bin/bootstrap.sh
      
      - name: Install build dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential git clang curl libc++-dev libc++abi-dev libperl-dev
          sudo ln -s /usr/bin/ld.lld /usr/bin/ld
      
      - name: Prepare build structure
        run: |
          # åˆ›å»ºæ ‡å‡†Theosé¡¹ç›®ç»“æž„
          mkdir -p Tweak/Resources
          
          # ç§»åŠ¨ä¸»ä»£ç æ–‡ä»¶
          mv *.m Tweak/Tweak.xm
          
          # åº”ç”¨ç¼–è¯‘é…ç½®
          cp .github/templates/Makefile Tweak/
          cp .github/templates/control Tweak/
          
          # ç§»åŠ¨èµ„æºæ–‡ä»¶
          mv *.png Tweak/Resources/ 2>/dev/null || true
          mv *.mp4 Tweak/Resources/ 2>/dev/null || true
      
      - name: Build ARM64 package
        env:
          THEOS_MAKE_PATH: /opt/theos/makefiles
          ARCHS: arm64
        run: |
          cd Tweak
          make clean
          make package
        
      - name: Upload artifact ðŸ”¼
        uses: actions/upload-artifact@v4  # å·²æ›´æ–°åˆ° v4 ç‰ˆæœ¬
        with:
          name: iOS18SiriRipple_Deb_Package
          path: Tweak/packages/*.deb