name: Build iOS18SiriRipple Deb

# 关键修复：修正事件触发器语法（图片中第22行错误）
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Theos environment
        run: |
          export THEOS=/opt/theos
          sudo rm -rf $THEOS
          sudo git clone --depth=1 https://github.com/theos/theos.git $THEOS
          sudo $THEOS/bin/update-theos
          echo "THEOS=$THEOS" >> $GITHUB_ENV
      
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential clang lld git perl libc++-dev
          sudo ln -sf /usr/bin/ld.lld /usr/bin/ld
      
      - name: Prepare build
        run: |
          mkdir -p Tweak
          mv *.m Tweak/Tweak.xm
          cp .github/templates/Makefile Tweak/
          cp .github/templates/control Tweak/
          tree
      
      - name: Build package
        working-directory: ./Tweak
        run: |
          make clean
          make package ARCHS=arm64
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: iOS18SiriRipple_Deb
          path: Tweak/packages/*.deb