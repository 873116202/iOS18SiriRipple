name: Build iOS18SiriRipple Deb

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup Theos
        run: |
          export THEOS=/opt/theos
          sudo git clone --depth=1 https://github.com/theos/theos.git $THEOS
          echo "THEOS=$THEOS" >> $GITHUB_ENV
          sudo $THEOS/bin/bootstrap.sh
          
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential git clang curl libc++-dev libc++abi-dev
          sudo ln -s /usr/bin/ld64 /usr/bin/ld
          
      - name: Prepare build directory
        run: |
          mkdir -p Tweak
          mv *.m Tweak/Tweak.xm  # 重命名主文件
          cp .github/templates/Makefile Tweak/
          cp .github/templates/control Tweak/
          
      - name: Build package
        run: |
          cd Tweak
          make clean
          make package ARCHS=arm64
          
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: iOS18SiriRipple_Deb
          path: Tweak/packages/*.deb
