name: Build iOS18SiriRipple.deb

on:
  pull_request:  # 添加对PR的触发
  push:
    branches: [main]

jobs:
  build-deb:
    # 添加失败重试机制
    runs-on: macos-latest
    continue-on-error: false
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        ref: ${{ github.event.pull_request.head.sha }}  # 确保检出PR分支
    
    # 添加编译前清理
    - name: Clean previous builds
      run: |
        rm -rf build_output *.deb package
        
    # ... [其他步骤同之前] ...
    
    # 在build步骤后添加诊断
    - name: Diagnostic after build
      run: |
        echo "🔍 构建产物分析:"
        find build_output -name iOS18SiriRipple -print
